function updateHashVars(){lochash=window.location.hash?window.location.hash:null;nohashloc=lochash?lochash.replace("#",""):null;checkHash()}function checkHash(){if(!lochash){overrideScroll=false;$("#webinar-list").slideDown()}else if(lochash=="#order"){overrideScroll=true;if(accountData){ajaxStatus.showit();account.populateOrderPage()}else{login.removeCloses();login.showModal()}}else{overrideScroll=true;if(accountData){ajaxStatus.showit();account.populateVideoPage(nohashloc)}else{login.showModal();login.removeCloses()}}}function appendError(e,t){if(t){$(".errorBox").html("")}$(".errorBox").append(e+"<br>").show()}function webinarClickEvent(e){if(!cart){if(!$("#cart").is(":visible")){cartToggle();cartBtnToggle()}cart={}}if(e.hasClass("added")){return}var t=new Webinar(e);cart[t.urlkey]=t;e.html("Added to cart").addClass("added");addToCart(t.urlkey)}function Webinar(e){this.urlkey=e.parents("li").find(".uniqidlbl").attr("id");this.price=e.parents("li").find(".price").html();this.memberprice=e.parents("li").find(".memberprice").html();this.title=e.parents("li").find(".webinar-title").html();this.duration=e.parents("li").find(".duration").attr("id");if(!this.duration||!this.price||!this.title||!this.urlkey||!this.memberprice){appendError("Warning: Null fields exist in webinar")}}function addToCart(e){var t=cart[e];$(".cart-content").append('<li><label class="hidden-label uniqidlbl">'+t.urlkey+"</label>"+t.duration+" access to "+t.title+" for $"+t.price+'&nbsp;<button class="close removeFromCart" type="button" aria-hidden="true">&times;</button></li>');$(".checkout-cart-content").append('<li><label class="hidden-label uniqidlbl">'+t.urlkey+"</label>"+t.duration+" access to "+t.title+" for $"+t.price+"</li>");updateCartTotal()}function emptyCart(){$.each(cart,function(e,t){removeFromCart($("li").find(".uniqidlbl:contains('"+t.urlkey+"')"))})}function removeFromCart(e){e=e.parent("li");var t=e.find(".uniqidlbl").html();$(".checkout-cart-content").find(".uniqidlbl").each(function(e,n){if($(this).text().match(t)){$(this).parents("li").remove()}});e.remove();delete cart[t];$("#"+t).parents("li").find(".cartBtn").removeClass("added").html("Add To Webinar Cart");updateCartTotal()}function updateCartTotal(){var e=0;var t=0;var n=0;if(cart){$.each(cart,function(e,r){n+=parseFloat(r.memberprice);t+=parseFloat(r.price)})}if(memberStatus){e=n;discountDifference=n-t}else{e=t;discountDifference=null}if(e>0){$(".cart-total").html("Total: $"+e).css("text-align","right");$("#checkout-button").prop("disabled",false)}else{$(".cart-total").html("Your Cart is Empty").css("text-align","center");$("#checkout-button").prop("disabled",true)}if(discountDifference){$(".price-difference").html("Member Discount: $"+discountDifference).show()}else{$(".price-difference").empty().hide()}amtTotal=e}function cartToggle(){$("#cart").toggle()}function cartBtnToggle(){$("#toggleCart").toggleClass("active")}function searchForWebinar(e){$(".webinar-list-item").hide();if(!e){overrideScroll=false;$(".webinar-list-item").webinarScroll(true);clearSearchMsg()}else{var t=0;$(".webinar-list-item").each(function(n,r){if($(this).text().toLowerCase().match(e.toLowerCase())){$(this).show();t++}});if(t>0){overrideScroll=true;$("#search-msg").html(t+" Results Found.")}else{overrideScroll=false;$(".webinar-list-item").webinarScroll(true);$("#search-msg").html("No Search Results Found.").show()}}}function clearSearchMsg(){$("#search-msg").html("")}function prepareModal(){$("#paymentModal").appendTo("body").modal("show")}function processUserCheck(){var e=isAEMember($("#pmt-email").val());if(e){if(e.member){memberStatus=true;$("#pmt-email").addClass("activemember").removeClass("nonmember");$("#company-greeting").html("Hello, "+e.company+"! Your cart has updated to reflect member pricing.").show()}else{memberStatus=false;$("#pmt-email").removeClass("activemember").addClass("nonmember");$("#company-greeting").html("You are not a registered and/or active member.").show()}updateCartTotal()}}function checkout(){ccType="";freezeCart=cart;checkoutController.status(10,"Checking Billing Information...");setTimeout(function(){var e=checkoutController.validatePaymentForm();if(e){checkoutController.status(40,"Processing your "+ccType+". Please Wait....");setTimeout(function(){var e=checkoutController.processCard();if(e.state=="approved"){checkoutController.status(70,"Transaction Approved. Creating Webinar Key...");setTimeout(function(){var t=checkoutController.addOrder(e.payment_id);if(t.passkey){checkoutController.status(90,"Order has been created. Sending email...");setTimeout(function(){passkey=t.passkey;transactionidgbl=e.payment_id;var n=checkoutController.sendEmail("neworder");if(n.success){checkoutController.success()}else{checkoutController.error("There was a problem sending the notifications. There may be a problem with our server. Please try again later.")}},1600)}else{checkoutController.error("There was a problem adding your order to our database. Our site may be experiencing issues.")}},1200)}else{checkoutController.error("There was a problem processing your card. Please verify the information you have entered and retry.")}},800)}else{checkoutController.error(gblerr);return}},400)}function emailValidation(e){var t=$(e).val();var n=/^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;if(n.test(t)){return true}else if(!t){return false}else{return false}}function isAEMember(e){$.ajax({url:$(".ajaxlocation-checkuser").html(),dataType:"json",type:"POST",async:false,data:{email:e},success:function(e){results=e}});return results}var lochash=window.location.hash?window.location.hash:null;var nohashloc=lochash?lochash.replace("#",""):null;var cart=null;var overrideScroll=false;var kypTimeout;var memberStatus;var amtTotal;var discountDifference;var ccType;var gblerr;var freezeCart;var passkey;var transactionidgbl;var accountData;var hashChange;$(document).ready(function(){ajaxStatus.hideit();$(".footerBg").removeClass("sbar");checkoutController.hideStatus();$(".memberpriceelement").tooltip({title:"AE member price is applied after entering your email in the checkout process"});$("#psk-transaction").tooltip({title:"We ask you for your transaction ID for extra security. Your transaction ID can be found in your order email near the total at the bottom."});$(".webinar-list-item").webinarScroll(true);$(window).scroll(function(){$(".webinar-list-item").webinarScroll()});$(".cartBtn").click(function(){webinarClickEvent($(this))});$(".complete-checkout").click(function(){checkout()});$("#toggleCart").click(function(){cartToggle()});$("#checkout-button").click(function(){prepareModal()});$(".webinar-search").keyup(function(){searchForWebinar($(this).val())});$(".change-psk").keyup(function(e){if($("#psk-current").val()&&$("#psk-new").val()&&$("#psk-transaction").val()){$("#change-psk-btn").prop("disabled",false);if(e.keyCode==13){account.pskChange()}}else{$("#change-psk-btn").prop("disabled",true)}});$("#change-psk-btn").click(function(){account.pskChange()});$("#payment-modal").on("hidden.bs.modal",function(){checkoutController.hideStatus()});$("#pmt-email").keyup(function(){if(kypTimeout){clearTimeout(kypTimeout)}var e=emailValidation(this);if(e){kypTimeout=setTimeout(function(){processUserCheck()},1500)}else{memberStatus=false;$(this).removeClass("activemember").addClass("nonmember");$("#company-greeting").empty().hide();updateCartTotal()}});$(".login-modal-btn").click(function(){login.showModal()});$(".login-inputs").keyup(function(e){if(e.keyCode==13){login.process()}});$(".login-btn").click(function(){login.process()});$(document.body).on("click",".removeFromCart",function(){removeFromCart($(this))});$(document.body).on("click",".account-list-item",function(){account.populateVideoPage($(this).find(".list-uniqidlbl").text());account.clearPages("order")});$(document.body).on("click",".go-back-to-account",function(){account.populateOrderPage();account.clearPages("video")});$(window).on("hashchange",function(){if(hashChange===true){hashChange=false}else{account.clearPages("order");account.clearPages("video");updateHashVars()}});updateCartTotal();checkHash()});var account={populateVideoPage:function(e){overrideScroll=true;$(".page:not('#video-page')").hide();var t=webinarActions.getInfo(e);var n=new RegExp("(?:^|(?:\\.\\s))(\\w+)","g");$("#video-page").html('<h1><span class="glyphicon glyphicon-play"></span> &nbsp;You are now watching '+t.title+'.</h1><video id="webinar-video" class="video-js vjs-default-skin vjs-big-play-centered" controls preload="auto" width="960" height="520"><source src="'+t.video+'" type="video/mp4">Sorry, we are using HTML5 video. Please update your browser to see this webinar. Try <a href="https://www.google.com/intl/en/chrome/browser/">Google Chrome</a></video><br /><br /><button type="button" class="btn btn-primary btn-lg btn-block go-back-to-account"><span class="glyphicon glyphicon-list"></span> &nbsp;Go Back to Order Overview</button><br /><p class="text-muted">Thanks for watching, '+n.exec(accountData.order_info)+". Don't forget to like us on <a href='https://www.facebook.com/pages/Associated-Employers/197713060277021'>Facebook</a> or <a href='https://twitter.com/aehumanresource/'>@AEhumanresource</a>.</p>");videojs("#webinar-video");$("#video-page").slideDown();hashChange=true;window.location.hash=e;ajaxStatus.hideit()},populateOrderPage:function(){overrideScroll=true;$(".page:not('#account-page')").hide();$("#account-page").slideDown();var e=accountData.urlkey_list.split(",");$.each(e,function(e,t){var n=webinarActions.getInfo(t);$(".account-order-list").append('<button class="list-group-item account-list-item"><h4 class="list-group-item-heading">'+n.title+'</h4><strong><h5 class="list-group-item-heading">http://www.associatedemployers.org/training/webinars/#'+t+'</h5></strong><p class="list-group-item-text">'+n.description+'</p><label class="hidden-label list-uniqidlbl">'+t+"</label></button>")});$(".fill-in-expiration-fromnow").html(moment(accountData.expiration).fromNow());$(".fill-in-expiration-date").html(accountData.expiration);$(".order-info").html(accountData.order_info.replace("\n","<br />"));if(accountData.transaction=="Manual Order"){$(".change-psk-body").html("We're sorry, passkey changes are unavailable for manual orders.")}hashChange=true;window.location.hash="order";ajaxStatus.hideit()},clearPages:function(e){if(e=="order"){$(".account-order-list").empty()}else if(e=="video"){$("#video-page").empty()}},pskChange:function(){if($("#psk-current").val()!==accountData.passkey){$(".psk-message").html("Invalid current passkey.")}else if($("#psk-transaction").val()!==accountData.transaction){$(".psk-message").html("Invalid transaction ID.")}else{var e=login.changePassword();if(e.success==true){var t=login.sendPskEmail();if(t){$(".change-psk").val("");$(".change-psk").prop("disabled",true);$("#change-psk-btn").prop("disabled",true);$(".psk-message").html("Passkey successfully changed. Please refresh the page to change again.")}else{$(".psk-message").html("There was a problem emailing your confirmation.")}}else{$(".psk-message").html("There was a problem changing your passkey.")}}}};var webinarActions={getInfo:function(e){var t;$.ajax({url:$(".ajaxlocation-webinarinformation").html(),dataType:"json",type:"GET",async:false,data:{urlkey:e},success:function(e){if(e){t=e}}});return t}};var login={showModal:function(){$("#loginModal").appendTo("body").modal("show")},hideModal:function(){$("#loginModal").modal("hide")},process:function(){login.disableFields();var e=login.validateLogin();if(e){if(e.urlkey_list){if(moment(e.expiration).isAfter()){if(nohashloc!=="order"&&lochash){var t=new RegExp("\\s"+nohashloc+"\\s");var n=" "+e.urlkey_list.toString().replace(/,/g," ")+" ";if(t.test(n)){login.checkExpirationLoop();login.hideModal();login.clearError();ajaxStatus.showit();accountData=e;account.populateVideoPage(nohashloc)}else{login.error("You do not have access to the url you tried to view or the url does not exist. Please check the url and try again. If you believe this message is in error, please <a href='http://www.associatedemployers.org/contact-us/'>contact us</a>.")}}else{login.checkExpirationLoop();login.hideModal();login.clearError();ajaxStatus.showit();accountData=e;account.populateOrderPage()}}else{login.error("Your order has expired and is no longer available.")}}else{login.error("Invalid login information.")}}else{login.error("Please complete all fields before attempting to login.")}},validateLogin:function(){var e=false;$(".login-inputs").removeClass("invalid");if(!emailValidation("#login-email")){$("#login-email").addClass("invalid");e=true}if(!$("#login-passkey").val()){$("#login-passkey").addClass("invalid");e=true}if(e){return false}var t;$.ajax({url:$(".ajaxlocation-validatelogin").html(),dataType:"json",type:"POST",async:false,data:{email:$("#login-email").val(),passkey:$("#login-passkey").val()},success:function(e){t=e}});return t},disableFields:function(){$(".login-inputs").prop("disabled",true)},enableFields:function(){$(".login-inputs").prop("disabled",false)},error:function(e){$(".login-message").html(e).show();login.enableFields()},clearError:function(){login.enableFields();$(".login-message").empty().hide()},removeCloses:function(){$(".login-close").remove()},checkExpirationLoop:function(){setInterval(function(){if(moment().isAfter(accountData.expiration)){location.reload(true)}},30*6e4)},sendPskEmail:function(){var e;$.ajax({url:$(".ajaxlocation-sendmail").html(),dataType:"json",type:"POST",async:false,data:{type:"changepsk",email:accountData.email},success:function(t){e=t}});return e},changePassword:function(){var e;$.ajax({url:$(".ajaxlocation-changepsk").html(),dataType:"json",type:"POST",async:false,data:{email:accountData.email,psk_current:$("#psk-current").val(),psk_new:$("#psk-new").val(),transaction_id:$("#psk-transaction").val()},success:function(t){e=t}});return e}};var ajaxStatus={showit:function(){$(".loader").show()},hideit:function(){$(".loader").hide()}};var checkoutController={processCard:function(){var e="";$.ajax({url:$(".ajaxlocation-processpayment").html(),dataType:"json",type:"POST",async:false,data:{addrline1:$("#pmt-address-line1").val(),addrline2:$("#pmt-address-line2").val(),addrcity:$("#pmt-address-city").val(),addrzip:$("#pmt-address-zipcode").val(),addrstate:$("#pmt-address-state").val(),cardnumber:$("#pmt-cc-number").val(),cardtype:ccType,cardexpiremonth:$("#pmt-cc-expire-month").val(),cardexpireyear:$("#pmt-cc-expire-year").val(),cardcvv2:$("#pmt-cc-cvv2").val(),cardfirstname:$("#pmt-cc-first-name").val(),cardlastname:$("#pmt-cc-last-name").val(),amounttotal:amtTotal},success:function(t){if(t){e=t}}});return e},validatePaymentForm:function(){var e="";var t=false;gblerr="";ccType="";$("#paymentModal").find(".validate").each(function(n,r){$(this).removeClass("invalid");var i=$(this).val();var s=$(this).attr("data-validation-type");var o=false;if(!s){if(!i){if(!t){e+="Please complete all fields.<br />";t=true}o=true}}else{if(s=="email"){var u=/^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;if(!u.test(i)){e+="Please enter a valid Email Address.<br/>";o=true}}else if(s=="street"){var a=/^(\d{3,})\s?(\w{0,5})\s([a-zA-Z]{2,30})\s([a-zA-Z]{2,15})\.?\s?(\w{0,5})$/;if(!a.test(i)){e+="Please enter a valid Street Address.<br/>";o=true}}else if(s=="zipcode"){if(i.length!==5){e+="Please enter a valid Zipcode.<br/>";o=true}}else if(s=="cvv2"){i=i.length;if(i<3||i>4){e+="Please enter a valid CVV2 #.<br/>";o=true}}else if(s=="ccnumber"){$("#pmt-cc-number").validateCreditCard(function(t){if(t.length_valid&&t.luhn_valid){ccType=t.card_type.name}else{e+="Please enter a valid Credit Card number.<br/>";o=true}},{accept:["visa","mastercard","discover","amex"]})}}if(o){$(this).addClass("invalid")}});if(e){gblerr=e;return false}else{return true}},addOrder:function(e){var t=freezeCart;var n=moment().add("days",90).format("YYYY/MM/DD");var r;var i=new Array;$.each(t,function(e,t){i.push(t.urlkey)});itemList=i.join(",");$.ajax({url:$(".ajaxlocation-addorder").html(),dataType:"json",type:"POST",async:false,data:{items:itemList,expiration:n,transaction_id:e,email:$("#pmt-email").val(),total:amtTotal,order_info:$("#pmt-cc-first-name").val()+" "+$("#pmt-cc-last-name").val()+"\n"+$("#pmt-address-line1").val()+" "+$("#pmt-address-line2").val()+"\n"+$("#pmt-address-city").val()+", "+$("#pmt-address-state").val()+" "+$("#pmt-address-zipcode").val()+"\n",company:$("#pmt-company").val()},success:function(e){r=e}});return r},sendEmail:function(e){var t;var n=freezeCart;var r=new Array;var i=new Array;var s=moment().add("days",90).format("YYYY/MM/DD");$.each(n,function(e,t){r.push(t.duration+" day access to "+t.title)});$.each(n,function(e,t){i.push('<a href="http://www.associatedemployers.org/training/webinars/#'+t.urlkey+'">http://www.associatedemployers.org/training/webinars/#'+t.urlkey+"</a>")});var o=r.join("<br />");var u=i.join("<br />");$.ajax({url:$(".ajaxlocation-sendmail").html(),dataType:"json",type:"POST",async:false,data:{type:e,email:$("#pmt-email").val(),firstname:$("#pmt-cc-first-name").val(),amount_total:amtTotal,expiration:s,item_list:o,url_list:u,passkey:passkey,transaction:transactionidgbl},success:function(e){t=e}});return t},status:function(e,t,n){$(".progress-bar").removeClass("progress-bar-danger").show().animate({width:e+"%"},100);$(".checkout-progress").html(t).show();$(".checkout-btns:visible").slideUp();$("#paymentModal").find("input, select").prop("disabled",true)},error:function(e){$(".progress-bar").addClass("progress-bar-danger").css("width","100%").show();$(".checkout-progress").html(e).show();$(".checkout-btns").slideDown();$(".complete-checkout").html("Retry");$("#paymentModal").find("input, select").prop("disabled",false)},hideStatus:function(){$(".progress-bar").hide();$(".checkout-progress").empty().hide();$(".checkout-btns").show();$("#paymentModal").find("input, select").prop("disabled",false);$(".complete-checkout").html("Purchase")},success:function(){$("#paymentModal").modal("hide");checkoutController.hideStatus();emptyCart();updateCartTotal();cartToggle();cartBtnToggle();$("#successModal").find(".fill-in-name").html($("#pmt-cc-first-name").val());$("#successModal").find(".fill-in-expiration").html(moment().add("days",90).format("YYYY/MM/DD"));$("#successModal").appendTo("body").modal("show")}};$.fn.webinarScroll=function(e){if(overrideScroll){return}var t="."+$(this).attr("class");if(e){$(t).hide();$(t+":lt(3)").fadeIn(100)}else{var n=$(t+":visible").last();if($(window).scrollTop()+$(window).height()/1.5>n.offset().top){$(t+":not(:visible):lt(3)").fadeIn(200)}}}